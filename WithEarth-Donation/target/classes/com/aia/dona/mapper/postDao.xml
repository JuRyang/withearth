<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="com.aia.dona.dao.PostDao">

     <resultMap id="postDetailResult" type="com.aia.dona.domain.PostOnly">  
        <result column="dona_idx" property="donaIdx" />   
		<result column="dona_title" property="postTitle" />
		<result column="dona_content" property="postContent" />
		<result column="dona_category" property="category" />
		<result column="dona_writedate" property="writedate" />				
		<result column="idx" property="idx" />
	</resultMap> 

      <resultMap id="postResult" type="com.aia.dona.domain.Post">  
        <result column="dona_idx" property="donaIdx" />   
		<result column="dona_title" property="postTitle" />
		<result column="dona_content" property="postContent" />
		<result column="dona_category" property="category" />
		<result column="dona_writedate" property="writedate" />				
		<result column="idx" property="idx" />
		<collection property="files" resultMap="fileResult"/>	
	</resultMap> 	
	
	<resultMap id="fileResult" type="com.aia.dona.domain.PostFile">
	   <result column="file_idx" property="fileIdx"/>
	   <result column="file_name" property="fileName"/>
	    <result column="dona_idx" property="donaIdx"/>
	</resultMap>

	<insert id="insertPost" parameterType="com.aia.dona.domain.Post"
		useGeneratedKeys="true" keyProperty="donaIdx">
		insert into donapost(dona_title, dona_content, dona_category, idx)
		values(#{postTitle}, #{postContent}, #{category}, #{idx})
	</insert>
	
	<select id="getDonaIdx" resultType="int">
	  SELECT LAST_INSERT_ID();
	</select>

	<select id="selectPostList" resultMap="postResult">
	SELECT * FROM donapost p left join postfile f on p.dona_idx=f.dona_idx	
	</select>
	
	<select id="selectPostDetail" resultMap="postDetailResult">	 
      select * from donapost where dona_idx=#{idx}
	</select>
	
	<select id="selectMyPostList" resultMap="postDetailResult">
	  select * from donapost where idx=#{idx}
	</select>

</mapper>