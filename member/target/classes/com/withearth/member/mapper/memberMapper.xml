<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.withearth.member.dao.MemberDAO">

<!-- 로그인할때 사용2) Member타입의 resultMap 왜써야 하는건지 모르겠어요-->
<resultMap id="memberResult"
			type="com.withearth.member.domain.Member">
	<id column="idx" property="idx"/>
	<result column="id" property="id"/>
	<result column="pw" property="pw"/>
	<result column="name" property="name"/>
	<result column="photo" property="photo"/>
</resultMap>


<!-- 회원가입 -->

<insert id="insertMember"
	parameterType="com.withearth.member.domain.Member"
	useGeneratedKeys="true"
	keyProperty="idx"
	>
<if test="photo != null and logintype=='email'">
INSERT INTO USER (id,pw,name,photo,logintype,code) 
VALUES( #{id}, #{pw}, #{name}, #{photo}, #{logintype}, #{code})
</if>
<if test="photo == null and logintype=='email'">
INSERT INTO USER (id,pw,name,logintype,code) 
VALUES( #{id}, #{pw}, #{name}, #{logintype}, #{code} )
</if>
<if test="logintype=='kakao'">
INSERT INTO USER (id,name,photo,logintype,verify) 
VALUES( #{id}, #{name}, #{photo}, #{logintype}, #{verify} )
</if>
</insert>

<!-- 로그인 -->
<select id="selectLogin"
		resultMap="memberResult"> <!-- id와 매핑된다. -->

select * from user where id= #{param1} and pw=#{param2}
</select>

<!-- 아이디 중복체크 / 이메일 보내기-->
<select id="selectMemberByIdCount" resultType="int">
	select count(*) from user where id = #{id}
</select>

<!-- 아이디 패스워드 일치여부확인 -->
<select id="selectMemberByIdPwCount" resultType="int">
	select count(*) from user where id= #{param1} and pw=#{param2}
</select>

<!-- 아이디/패스워드 일치 + verify='N'인 경우 -->
<select id="selectMemberByIdPwVerifyCount" resultType="int">
	select count(*) from user where id= #{param1} and pw=#{param2} and verify='N'
</select>
<!-- 이메일 인증 -->
	<select id="selectMemberByIdxVerify"
					resultType="int"
	>
		select count(*) from user where idx=#{idx} and verify='Y'
	</select>
	
	<update id="updateMemberVerify">
		update user set verify='Y' where idx=#{param1} and code=#{param2}
	</update>

</mapper>