<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.withearth.community.matdao.MatDao">
	
	<!-- 맛집리스트 출력 -->
	<resultMap id="matResult" type="com.withearth.community.domain.MatzipVo">
		<id column="mat_idx" property="matIdx" />
		<result column="mat_title" property="matTitle" />
		<result column="mat_addr" property="matAddr" />
		<result column="mat_time" property="matTime" />
		<result column="mat_cont" property="matCont" />
		<result column="mat_img" property="matImg" />
		<result column="mat_date" property="matDate" />
		<result column="mat_heart" property="matHeart" />
		<result column="idx" property="idx" />
	</resultMap>

	<!-- 맛집리스트 출력 -->
	<resultMap id="matListResult" type="com.withearth.community.domain.MatzipVo">
		<id column="mat_idx" property="matIdx" />
		<result column="mat_title" property="matTitle" />
		<result column="mat_addr" property="matAddr" />
		<result column="mat_time" property="matTime" />
		<result column="mat_cont" property="matCont" />
		<result column="mat_img" property="matImg" />
		<result column="mat_date" property="matDate" />
		<result column="mat_heart" property="matHeart" />
		<result column="idx" property="idx" />
	</resultMap>
	
	
	<!-- 전체 맛집리스트 출력 -->
	<select id="selectAllMatList"
					parameterType="map"
					resultMap="matListResult">

		select * from Matzip

	</select>
	
	<!-- 맛집추가 -->
	<insert id="insertMatzip"
	parameterType="com.withearth.community.domain.MatzipVo"
	useGeneratedKeys="true"
	keyProperty="matIdx"
	>
	
	INSERT INTO Matzip
	
	<if test="matImg == null">
	(mat_title, mat_addr, mat_time, mat_num, mat_cont)
	VALUES
	(#{matTitle},#{matAddr},#{matTime},#{matNum},#{matCont})
	</if>
	
	<if test="matImg != null">
	(mat_title, mat_addr, mat_time, mat_Num, mat_cont, mat_img)
	VALUES
	(#{matTitle},#{matAddr},#{matTime},#{matNum},#{matCont},#{matImg})
	</if>
	</insert>
	
	
	<!-- 파일 업로드 -->
	<insert id="fileUpload" parameterType="HashMap">
	insert into Matfile
	(file_idx, mat_idx ,org_name, new_name, file_size)
	VALUES
	(#{fileIdx}, #{matIdx}, #{orgFileName}, #{newFileName}, #{fileSize})
	
	</insert>
	
	
	<!--  맛집 수 업데이트 -->
	<update id="matUpdateCnt">
		update matzip_cnt set matzipCnt = matzipCnt + 1 
	</update>
	
	<!-- 총 맛집 수 -->
	<select id="selectTotalCount" resultType="int">
		select count(*) from Matzip
	</select>

</mapper>